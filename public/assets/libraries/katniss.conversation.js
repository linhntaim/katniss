function setupPushClient(q,A,e,i){_pushClient=new PushClient(q,A,e,i)}function pushClient(){if(_pushClient)return _pushClient;alert("Setup push client first")}function sendToPusher(q,A){pushClient().send(q,A)}function subscribePusher(q,A){pushClient().subscribe(q,A)}function registerPusher(){pushClient().register()}function stopSound(){_sound&&(_sound.pause(),_sound=null)}function base64Sound(q){return"data:audio/mpeg;base64,"+q}function playSound(q){stopSound(),_sound=new Audio(q),_sound.play()}var PushSubscriber=function(q,A){this.channel=q,this.callback=A},PushClient=function(q,A,e,i){this.isConnected=!1,this.connection=null,this.serverUrl=q,this.clientId=A,this.clientKey=e,this.clientSecret=i,this.subscribers=[]};PushClient.prototype.register=function(){if(!this.isConnected){var q=this;loadOrtcFactory(IbtRealTimeSJType,function(A,e){null!=e?alert("Factory error: "+e.message):null!=A&&(q.connection=A.createClient(),q.connection.setId(q.clientId),q.connection.setClusterUrl(q.serverUrl),q.connection.onConnected=function(A){q.isConnected=!0;for(var e in q.subscribers){var i=q.subscribers[e];q.connection.subscribe(i.channel,!0,i.callback)}},q.connection.onDisconnected=function(q){},q.connection.onSubscribed=function(q,A){},q.connection.onException=function(q,A){},q.connection.onReconnecting=function(q){},q.connection.onReconnected=function(q){},q.connection.connect(q.clientKey,q.clientSecret))})}},PushClient.prototype.subscribe=function(q,A){this.subscribers.push(new PushSubscriber(q,A))},PushClient.prototype.send=function(q,A){this.connection.send(q,JSON.stringify(A))};var _pushClient,FACEBOOK_CHAT_SOUND="sounds/facebook_chat_sound.mp3",FACEBOOK_CHAT_SOUND_64="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qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy45N6qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5Jk7o/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",_sound;$(document).ready(function(){function q(){if(u.enablePreviousMessages){new KatnissApi(!0).get("messages",{previous:1,conversation_id:CONVERSATION_ID,message_id:u.topMessageId},function(A,e,i){(A||e.messages.length<e.max_messages)&&(u.enablePreviousMessages=!1),A||(t(e.messages),u.$messageFirstChild.height()>10&&(u.forceScrollToBottom=!0,q()))})}}function A(q,A){sendToPusher(CONVERSATION_CHANNEL,{type:q,data:A})}function e(q){if(""!=q.trim()){new KatnissApi(!0).post("messages",{conversation_id:CONVERSATION_ID,content:q},function(q,e,i){A("conversation",{message:e.message,device_id:e.device_id,device:KATNISS_USER===!1?{id:CURRENT_DEVICE_REAL_ID,color:CONVERSATION_DEVICES[CURRENT_DEVICE_REAL_ID]}:null,user:KATNISS_USER!==!1?{id:CURRENT_DEVICE_REAL_ID,url:CONVERSATION_USERS[CURRENT_DEVICE_REAL_ID],title:KATNISS_USER.display_name}:null})})}}function i(q){return q=q.replace(/((http|https|ftp|ftps)\:\/\/[^\s]+)/g,'<a href="$1" target="_blank">$1</a>'),q=q.replace(/[\n]/g,"<br>")}function t(q){if(!(q.length<=0)){var A=null==u.topMessageId||u.forceScrollToBottom;u.forceScrollToBottom=!1;var e;for(var t in q)e=i(q[t].content),e=strReplaceMany(q[t].is_owner?g:c,{id:q[t].id,message:e,device:isSet(q[t].device_id)?"device":"user",style:isSet(q[t].device_id)?"background-color:#"+CONVERSATION_DEVICES[q[t].device_id]:"background-image:url("+CONVERSATION_USERS[q[t].user_id]+")"}),u.prepend(e),u.topMessageId=q[t].id;l.autoSetHeight(),A?u.scrollToBottom():u.scrollToTop()}}function s(q){var A=i(q.content);A=strReplaceMany(q.is_owner?g:c,{id:q.id,message:A,device:isSet(q.device_id)?"device":"user",style:isSet(q.device_id)?"background-color:#"+CONVERSATION_DEVICES[q.device_id]:"background-image:url("+CONVERSATION_USERS[q.user_id]+")"}),u.append(A),u.scrollToBottom(),q.is_owner||playSound(base64Sound(FACEBOOK_CHAT_SOUND_64))}function n(){u.addTyping()}function o(){u.removeTyping()}function r(q,A){var e=!1;isSet(q)&&!isSet(CONVERSATION_USERS[q.id])&&(CONVERSATION_USERS[q.id]=q.url,a.$userBoxes.find(".square-box:last").after(strReplaceMany('<div class="square-box user" style="background-image:url({url})" title="{title}" data-toggle="tooltip" data-placement="bottom"></div>',{id:q.id,url:q.url,title:q.title})),a.$userBoxes.find(".square-box:last").tooltip(),e=!0),isSet(A)&&!isSet(CONVERSATION_DEVICES[A.id])&&(CONVERSATION_DEVICES[A.id]=A.color,a.$userBoxes.find(".square-box:last").after(strReplaceMany(d,{id:A.id,color:A.color})),a.$userBoxes.find(".square-box:last").tooltip(),e=!0),e&&a.autoLayout()}var a,u,l,c='<div id="box-{id}" class="square-box {device}" style="{style}"></div><p id="message-{id}" class="bg-info message pull-left">{message}</p><div id="clearfix-{id}" class="clearfix"></div>',g='<p id="message-{id}" class="bg-primary message pull-right">{message}</p><div id="clearfix-{id}" class="clearfix"></div>',h='<span class="text-grey">'+IS_TYPING_LABEL+"</span>",d='<div class="square-box device" style="background-color:#{color}" title="'+ANONYMOUS_LABEL+'-{id}" data-toggle="tooltip" data-placement="bottom"></div>';a={$self:$("header"),$wrapper:$("header > .wrapper"),$userBoxes:$("#user-boxes"),$scrollControls:null,$users:null,marginLeft:0,init:function(){var q=this;this.$users=this.$userBoxes.find(".users"),this.$scrollControls=this.$userBoxes.find(".scrolling-control"),this.$scrollControls.on("click",function(){if($(this).hasClass("pull-left"))q.marginLeft+=32,q.marginLeft>16&&(q.marginLeft=16);else{q.marginLeft-=32;var A=q.$userBoxes.width()-q.$users.width();q.marginLeft<A&&(q.marginLeft=A-16)}q.$users.css("margin-left",q.marginLeft+"px")}),this.autoLayout()},autoLayout:function(){this.$users.width(32*this.$users.children().length),this.$users.width()>this.$userBoxes.width()?(this.$scrollControls.removeClass("hide"),this.marginLeft=16):(this.$scrollControls.addClass("hide"),this.marginLeft=0),this.$users.css("margin-left",this.marginLeft+"px")},height:function(){return this.$wrapper.height()}},u={$self:$("main"),$wrapper:$("main > .wrapper"),$messages:$("#messages"),$messageFirstChild:null,typing:!1,isTypingMessage:!1,removeTypingTimeout:null,topMessageId:null,forceScrollToBottom:!1,enablePreviousMessages:!0,init:function(){var A=this;A.$messageFirstChild=A.$messages.children().eq(0),A.autoSetHeight(),A.$wrapper.scroll(function(){0==A.$wrapper.scrollTop()&&q()})},height:function(){return this.$wrapper.height()},setHeight:function(q){q=q<0?0:q,this.$wrapper.height(q),this.autoSetFirstClearFixHeight()},autoSetHeight:function(){this.setHeight($(window).height()-l.height()-a.height())},autoSetFirstClearFixHeight:function(){var q=this,A=0,e=q.$messages.find(".clearfix");q.$messageFirstChild.height(10);for(var i=e.length-1;i>=1;--i)if(A+=e.eq(i).height(),A+10>q.height())return;var t=q.height()-A;q.$messageFirstChild.height(t<0?10:t)},prepend:function(q){this.$messageFirstChild.after(q)},append:function(q){this.isTypingMessage||!this.typing?this.$messages.append(q):this.$messages.find(".message").last().before(q),l.autoSetHeight()},clearRemoveTypingTimeout:function(){this.removeTypingTimeout&&(clearTimeout(this.removeTypingTimeout),this.removeTypingTimeout=null)},addTyping:function(){if(this.clearRemoveTypingTimeout(),!this.typing){this.isTypingMessage=!0,this.append(strReplaceMany(c,{id:"typing",message:h})),this.isTypingMessage=!1,this.typing=!0;var q=this;this.removeTypingTimeout=setTimeout(function(){q.removeTyping()},6e3)}},removeTyping:function(){this.clearRemoveTypingTimeout(),this.$messages.find("#box-typing,#message-typing,#clearfix-typing").remove(),this.typing=!1,l.autoSetHeight()},scrollToBottom:function(){this.$wrapper.scrollTop(this.$wrapper.get(0).scrollHeight)},scrollToTop:function(){this.$wrapper.scrollTop(42)}},l={$self:$("footer"),$wrapper:$("footer > .wrapper"),$textArea:$("#inputMessage"),$actions:$("#actions"),$button:$("#buttonSend"),$enter:$("#inputEnter"),isTyping:!1,typingTimeout:null,lastTypingTime:0,maxLength:0,lineHeight:0,paddingTop:0,paddingBottom:0,init:function(){var q=this;q.maxLength=parseInt(q.$textArea.attr("maxlength")),q.lineHeight=parseInt(q.$textArea.css("line-height")),q.paddingTop=parseInt(q.$textArea.css("padding-top")),q.paddingBottom=parseInt(q.$textArea.css("padding-bottom")),q.$textArea.on("keyup",function(){q.$textArea.val().length>=q.maxLength?q.$textArea.addClass("text-red"):q.$textArea.removeClass("text-red"),q.autoSetHeight(),q.endTyping()}).on("keydown",function(A){if(13==A.keyCode&&q.$enter.is(":checked"))return q.$button.trigger("click"),!1;116!=A.keyCode&&q.startTyping()}).on("startTyping",function(){A("typing",{value:!0,device_id:CURRENT_DEVICE_ID})}).on("endTyping",function(){A("typing",{value:!1,device_id:CURRENT_DEVICE_ID})}).focus(),q.$button.on("click",function(){var A=q.$textArea.val();q.$textArea.val("").focus(),e(A)});var i=Cookies.get("enter_to_send");void 0===i&&(Cookies.set("enter_to_send",1),i=1),q.$enter.prop("checked",1==i),q.$button.text(1==i?"Enter":"Send"),q.$enter.on("click",function(){var A=$(this).is(":checked");Cookies.set("enter_to_send",A?1:0),q.$button.text(1==A?q.$button.attr("data-action-press-enter"):q.$button.attr("data-action-send"))})},clearTypingTimeout:function(){this.typingTimeout&&(clearTimeout(this.typingTimeout),this.typingTimeout=null)},startTyping:function(){this.clearTypingTimeout();var q=(new Date).getTime();(!this.isTyping||q-this.lastTypingTime>3e3)&&(this.isTyping=!0,this.lastTypingTime=q,this.$textArea.trigger("startTyping"))},endTyping:function(){if(this.isTyping){this.clearTypingTimeout();var q=this;this.typingTimeout=setTimeout(function(){q.isTyping=!1,q.$textArea.trigger("endTyping")},3e3)}},height:function(){return this.$self.height()},setHeight:function(q){"none"==this.$actions.css("float")&&(q+=this.$actions.height()),this.$wrapper.height(q<0?0:q)},autoSetHeight:function(){var q=this;q.$textArea.height(0);var A=q.$textArea.get(0).scrollHeight-q.paddingTop-q.paddingBottom;q.$textArea.height(A),q.setHeight(A+q.paddingTop+q.paddingBottom+1),u.autoSetHeight()}},a.init(),l.init(),u.init(),q(),$(window).on("resize",function(q){a.autoLayout(),l.autoSetHeight()}),setupPushClient(ORTC_SERVER,ORTC_CLIENT_ID,ORTC_CLIENT_KEY,ORTC_CLIENT_SECRET),subscribePusher(CONVERSATION_CHANNEL,function(q,A,e){var i=$.parseJSON(e);if(i.type&&i.data)switch(i.type){case"conversation":o(),r(i.data.user,i.data.device);var t=i.data.message;CURRENT_DEVICE_ID!=i.data.device_id&&(t.is_owner=!1),s(t);break;case"typing":CURRENT_DEVICE_ID!=i.data.device_id&&(1==i.data.value?n():o());break;default:console.log("Unknown action.")}}),registerPusher(),$('[data-toggle="tooltip"]').tooltip()});